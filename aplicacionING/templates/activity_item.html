<li class="activity-item {% if activity in por_entregar %}por-entregar{% elif activity in atrasadas %}atrasada{% elif activity in completadas %}completada{% endif %}">
    <details>
        <summary>
            {{ activity.name }}
            {% if activity in atrasadas and activity.dias_atraso > 0 %}
                <span class="atraso">| Atrasado por {{ activity.dias_atraso }} días</span>
            {% endif %}
        </summary>

        <div class="activity-container">
            <p><strong>Descripción:</strong> {{ activity.description }}</p>

            <!-- Mostrar el usuario asignado -->
            {% if activity.assigned_to %}
                <p><strong>Asignado a:</strong> {{ activity.assigned_to.username }}</p>
            {% else %}
                <p><strong>Asignado a:</strong> No asignado</p>
            {% endif %}

            <p><strong>Fecha Límite:</strong> {{ activity.due_date }}</p>

            <!-- Botón para agregar tarea -->
            <a href="{% url 'create_task' activity_id=activity.id %}" class="button">Agregar Tarea</a>
            <div class="activity-container">
                <!-- Listar Tareas Asociadas -->
                <h4>Tareas de la Actividad</h4>
                <ul>
                    {% for task in activity.tasks.all %}
                        <li>
                            <details>
                                <summary>
                                    {{ task.name }}
                                    {% if task.completed %}
                                        (Completada)
                                    {% endif %}
                                </summary>
                                <p><strong>Descripción:</strong> {{ task.description }}</p>
                                <p><strong>Fecha Inicio:</strong> {{ task.start_date }}</p>
                                <p><strong>Fecha Fin:</strong> {{ task.end_date }}</p>
                                <div class="task-action-buttons">
                                    {% if not task.completed %}
                                        <form method="POST" style="display: inline;">
                                            {% csrf_token %}
                                            <input type="hidden" name="task_id" value="{{ task.id }}">
                                            <button type="submit" name="mark_complete" class="btn">Marcar como Completada</button>
                                        </form>
                                    {% endif %}
                                    <!-- Botón para eliminar la tarea -->
                                    <form method="POST" action="{% url 'delete_task' task_id=task.id %}" style="display: inline;">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-danger">Eliminar Tarea</button>
                                    </form>
                                </div>
                            </details>
                        </li>
                    {% empty %}
                        <p>No hay tareas asociadas a esta actividad.</p>
                    {% endfor %}
                </ul>
            </div>
            <div class="action-buttons">
                <form method="POST" action="{% url 'delete_activity' project_id=project.id activity_id=activity.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Eliminar Actividad</button>
                </form>
                <a href="{% url 'edit_activity' project_id=project.id activity_id=activity.id %}" class="btn btn-primary">Editar Actividad</a>
            </div>
        </div>
    </details>
</li>

<style>
    .activity-container {
        border: 2px solid #ccc;  /* Cambia el color del borde para diferenciar el contenedor */
        padding: 15px;
        border-radius: 8px;
        margin-top: 10px;
        margin-bottom: 10px;
    }

    .por-entregar {
        background-color: #fff3cd; /* Fondo amarillo claro */
        border: 1px solid #ffeeba; /* Borde ligeramente más oscuro */
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
    }

    .action-buttons {
        display: flex;
        align-items: center;
        gap: 10px; /* Espacio entre los botones */
    }

    .task-action-buttons {
        margin-top: 10px;
        display: flex;
        gap: 10px;
    }

    .btn-danger {
        background-color: #dc3545;
        color: white;
        border: none;
        padding: 8px 12px;
        cursor: pointer;
        border-radius: 4px;
    }

    .btn-danger:hover {
        background-color: #c82333;
    }
</style>